#!/bin/bash
# File: laravel-env-management.sh
# Author: Michael Brown
# Date: July 2, 2024
# Description: manage env file


################################################################################################
####   helpful links
################################################################################################
####
####    Link:https://stackoverflow.com/questions/57582453/is-there-a-suggested-list-of-values-for-laravels-app-env-variable-found-in-the
####    Notes: Link provides APP_ENV options.  Options are: local/development/staging/production
####    
####    Link:https://panjeh.medium.com/laravel-app-env-local-app-env-production-difference-aa9662ac81d0
####    Notes: Link provides a good APP_ENV explanation.
####
################################################################################################


################################################################################################
####   Build "development" .env file
################################################################################################
####
####    Notes: None
####    Steps:    
####        A. Create development env file 
####        B. Change env APP_DEBUG to true
####        C. Set APP_ENV to development
####
################################################################################################

function build_dev_env(){

    #A
    cp .env .env.development;

    #B
    sed -i 's/APP_DEBUG=false/APP_DEBUG=true/g' .env.dev;

    #C
    sed -i 's/APP_ENV=production/APP_ENV=dev/g' .env.development;

}

################################################################################################
####   Build "production" .env file
################################################################################################
####
####    Notes: None
####
####    Steps:
####        A. Create production env file  
####        B. Change env APP_DEBUG to false
####        C. Set APP_ENV to production
####
################################################################################################

function build_prod_env(){

    #A
    cp .env.example .env.production;

    #B
    sed -i 's/APP_DEBUG=true/APP_DEBUG=false/g' .env.production;

    #C
    sed -i 's/APP_ENV=local/APP_ENV=production/g' .env.production;

}

################################################################################################
####   Encrypt .env files
################################################################################################
####
####    Notes: None
####
####    Steps:    
####        A. Encrypt development and production files 
####        B. Delete unencrypted development and production files
####
################################################################################################

function encrypt_env(){

    #A
    php artisan env:encrypt --env=development --key=base64:2aW5VRyXlCr5ouiSIuxBwSwe0tbQMD6L38qORz/dvfI=;
    php artisan env:encrypt --env=production --key=base64:5rx2wFITSetiyYT+wb5iro2jFso/QgWzfRhhk0YSbVU=; 

    #B
    rm .env.dev;
    rm .env.production;

}

################################################################################################
####   Decrypt .env files
################################################################################################
####
####    Notes: None
####
####    Steps:    
####        A. Decrypt development and production files 
####        B. Delete encrypted development and production files
####
################################################################################################

function decrypt_env(){

    #A
    php artisan env:decrypt --env=development --key=base64:2aW5VRyXlCr5ouiSIuxBwSwe0tbQMD6L38qORz/dvfI=;
    php artisan env:decrypt --env=production --key=base64:5rx2wFITSetiyYT+wb5iro2jFso/QgWzfRhhk0YSbVU=;

    #B
    rm .env.dev.encrypted;
    rm .env.production.encrypted;

}

################################################################################################
####   Activate development env
################################################################################################
####
####    Notes: None
####
####    Steps:    
####        A. Activate development env 
####
################################################################################################

function activate_dev(){

    #A
    cp .env.development .env;

}

################################################################################################
####   Activate production env
################################################################################################
####
####    Notes: None
####
####    Steps:    
####        A. Activate production env 
####
################################################################################################

function activate_prod(){

    #A
    cp .env.production .env;

}
################################################################################################
####   Cash env
################################################################################################
####
####    Notes: Do not run option A on a development server.
####
####    Options:    
####        A. Cashe env 
####        B. Clear env cash
####
################################################################################################

function cashe_env(){

    #A
    php artisan config:cache;

}

function clear_cashe(){

    #B
    php artisan config:clear;

}

################################################################################################
####   Generate an env key
################################################################################################
####
####    Notes: Generates a key for the env APP_KEY.
####
################################################################################################

function gen_env_key(){

    php artisan key:generate

}




################################################################################################
####   Generate an env key
################################################################################################
####
####    function options: 
####        build_dev_env()
####        build_prod_env()
####        encrypt_env()
####        decrypt_env()
####        activate_dev()
####        activate_prod()
####        cashe_env()
####        clear_cashe()
####        gen_env_key()
####
################################################################################################

printf "\nEnter one of the following options:";
printf "\n1 Build env files";
printf "\n2 Encrypt env files";
printf "\n3 Decrypt env files";
printf "\n4 Set environment to production";
printf "\n5 Set environment to development";
printf "\n"

read -p "Enter one of the following options:" chosen_option;
echo "\nyou chose " $chosen_option;